var L=Object.create;var P=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var J=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var q=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of N(e))!$.call(t,n)&&n!==r&&P(t,n,{get:()=>e[n],enumerable:!(o=j(e,n))||o.enumerable});return t};var I=(t,e,r)=>(r=t!=null?L(R(t)):{},q(e||!t||!t.__esModule?P(r,"default",{value:t,enumerable:!0}):r,t));var k=J(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});function g(t,e,r){var o;if(r===void 0&&(r={}),!e.codes){e.codes={};for(var n=0;n<e.chars.length;++n)e.codes[e.chars[n]]=n}if(!r.loose&&t.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var i=t.length;t[i-1]==="=";)if(--i,!r.loose&&!((t.length-i)*e.bits&7))throw new SyntaxError("Invalid padding");for(var u=new((o=r.out)!=null?o:Uint8Array)(i*e.bits/8|0),a=0,s=0,l=0,c=0;c<i;++c){var f=e.codes[t[c]];if(f===void 0)throw new SyntaxError("Invalid character "+t[c]);s=s<<e.bits|f,a+=e.bits,a>=8&&(a-=8,u[l++]=255&s>>a)}if(a>=e.bits||255&s<<8-a)throw new SyntaxError("Unexpected end of data");return u}function b(t,e,r){r===void 0&&(r={});for(var o=r,n=o.pad,i=n===void 0?!0:n,u=(1<<e.bits)-1,a="",s=0,l=0,c=0;c<t.length;++c)for(l=l<<8|255&t[c],s+=8;s>e.bits;)s-=e.bits,a+=e.chars[u&l>>s];if(s&&(a+=e.chars[u&l<<e.bits-s]),i)for(;a.length*e.bits&7;)a+="=";return a}var D={chars:"0123456789ABCDEF",bits:4},O={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},B={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},U={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},K={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},F={parse:function(e,r){return g(e.toUpperCase(),D,r)},stringify:function(e,r){return b(e,D,r)}},M={parse:function(e,r){return r===void 0&&(r={}),g(r.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,O,r)},stringify:function(e,r){return b(e,O,r)}},V={parse:function(e,r){return g(e,B,r)},stringify:function(e,r){return b(e,B,r)}},_={parse:function(e,r){return g(e,U,r)},stringify:function(e,r){return b(e,U,r)}},G={parse:function(e,r){return g(e,K,r)},stringify:function(e,r){return b(e,K,r)}},Q={parse:g,stringify:b};p.base16=F;p.base32=M;p.base32hex=V;p.base64=_;p.base64url=G;p.codec=Q});var ee={[(-7).toString()]:"SHA-256",[(-35).toString()]:"SHA-384",[(-36).toString()]:"SHA-512"},te={[(-7).toString()]:"P-256",[(-35).toString()]:"P-384",[(-36).toString()]:"P-512"},re={[(-7).toString()]:"ECDSA",[(-35).toString()]:"ECDSA",[(-36).toString()]:"ECDSA"};var d=I(k(),1),oe=d.default.base16,se=d.default.base32,ie=d.default.base32hex,ce=d.default.base64,m=d.default.base64url,le=d.default.codec;function w(t){return new TextDecoder().decode(m.parse(t,{loose:!0}))}function E(t){return m.stringify(new TextEncoder().encode(t),{pad:!1})}var H=new TextEncoder,T=new TextDecoder,v=H.encode.bind(H),he=T.decode.bind(T);var X=t=>String.fromCharCode(...new Uint8Array(t)),Y=E,Z=w;var C=t=>v(Z(t));var y=t=>Y(X(t));var S=(t,e={})=>fetch(new Request(`https://api.passkeys.workers.dev/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"})),h;(r=>{async function t(o){return await(await S("attestation/generate",{userId:o})).json()}r.generate=t;async function e(o){let n=o.response,i={kid:o.id,clientDataJSON:y(n.clientDataJSON),attestationObject:y(n.attestationObject),pubkey:y(n.getPublicKey()),coseAlg:n.getPublicKeyAlgorithm()};return await(await S("attestation/store",i)).json()}r.store=e})(h||={});var A;(r=>{async function t(){return await(await S("assertion/generate",{})).json()}r.generate=t;async function e(o){let n=o.response,i={kid:o.id,clientDataJSON:y(n.clientDataJSON),authenticatorData:y(n.authenticatorData),signature:y(n.signature)};return await(await S("assertion/verify",i)).json()}r.verify=e})(A||={});if(window.PublicKeyCredential){async function t(a,s){let l=crypto.randomUUID(),{challenge:c}=await h.generate(l),f={challenge:C(c),rp:{id:window.location.host,name:document.title},user:{id:v(l),name:s,displayName:""},pubKeyCredParams:[{type:"public-key",alg:-36},{type:"public-key",alg:-35},{type:"public-key",alg:-7}],authenticatorSelection:{userVerification:"preferred",residentKey:"required"},attestation:"indirect",timeout:6e4},x=await window.navigator.credentials.create({publicKey:f,signal:a.signal});return await h.store(x)}async function e(a){let{challenge:s}=await A.generate(),l={challenge:C(s),rpId:window.location.host,timeout:6e4},c=await window.navigator.credentials.get({publicKey:l,signal:a.signal,mediation:"optional"});return await A.verify(c)}let r=document.querySelector("form#passkeys"),o=r.querySelector("button#signup"),n=r.querySelector("button#login"),i=document.querySelector("textarea#output");r.addEventListener("submit",a=>(a.preventDefault(),!1));let u=a=>async s=>{s.preventDefault();let l=new FormData(document.querySelector("form#passkeys")),c=new AbortController,f=l.get("username");if(s.target===o&&!f)return r.reportValidity();let x=await a(c,f);i&&(i.value=JSON.stringify(x,void 0,4))};o?.addEventListener("click",u(t)),n?.addEventListener("click",u(e))}
//# sourceMappingURL=index.js.map
