var L=Object.create;var C=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var F=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var _=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of R(e))!q.call(t,a)&&a!==r&&C(t,a,{get:()=>e[a],enumerable:!(n=j(e,a))||n.enumerable});return t};var I=(t,e,r)=>(r=t!=null?L(N(t)):{},_(e||!t||!t.__esModule?C(r,"default",{value:t,enumerable:!0}):r,t));var T=F(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});function d(t,e,r){var n;if(r===void 0&&(r={}),!e.codes){e.codes={};for(var a=0;a<e.chars.length;++a)e.codes[e.chars[a]]=a}if(!r.loose&&t.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var o=t.length;t[o-1]==="=";)if(--o,!r.loose&&!((t.length-o)*e.bits&7))throw new SyntaxError("Invalid padding");for(var i=new((n=r.out)!=null?n:Uint8Array)(o*e.bits/8|0),s=0,c=0,f=0,l=0;l<o;++l){var v=e.codes[t[l]];if(v===void 0)throw new SyntaxError("Invalid character "+t[l]);c=c<<e.bits|v,s+=e.bits,s>=8&&(s-=8,i[f++]=255&c>>s)}if(s>=e.bits||255&c<<8-s)throw new SyntaxError("Unexpected end of data");return i}function y(t,e,r){r===void 0&&(r={});for(var n=r,a=n.pad,o=a===void 0?!0:a,i=(1<<e.bits)-1,s="",c=0,f=0,l=0;l<t.length;++l)for(f=f<<8|255&t[l],c+=8;c>e.bits;)c-=e.bits,s+=e.chars[i&f>>c];if(c&&(s+=e.chars[i&f<<e.bits-c]),o)for(;s.length*e.bits&7;)s+="=";return s}var K={chars:"0123456789ABCDEF",bits:4},k={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},J={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},O={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},B={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},G={parse:function(e,r){return d(e.toUpperCase(),K,r)},stringify:function(e,r){return y(e,K,r)}},W={parse:function(e,r){return r===void 0&&(r={}),d(r.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,k,r)},stringify:function(e,r){return y(e,k,r)}},Q={parse:function(e,r){return d(e,J,r)},stringify:function(e,r){return y(e,J,r)}},X={parse:function(e,r){return d(e,O,r)},stringify:function(e,r){return y(e,O,r)}},Y={parse:function(e,r){return d(e,B,r)},stringify:function(e,r){return y(e,B,r)}},Z={parse:d,stringify:y};p.base16=G;p.base32=W;p.base32hex=Q;p.base64=X;p.base64url=Y;p.codec=Z});var M={["ES256"]:"P-256",["ES384"]:"P-384",["ES512"]:"P-512"},V={["ES256"]:"ECDSA",["ES384"]:"ECDSA",["ES512"]:"ECDSA"};var P={[(-7).toString()]:"P-256",[(-35).toString()]:"P-384",[(-36).toString()]:"P-512"},D={[(-7).toString()]:"ECDSA",[(-35).toString()]:"ECDSA",[(-36).toString()]:"ECDSA"},S=class{static async toCryptoKey(e,r,n){return await crypto.subtle.importKey("spki",e,{name:r,namedCurve:n},!0,["verify"])}static async toJWK(e){return await crypto.subtle.exportKey("jwk",e)}static async fromJWK(e){let r=V[e.alg],n=M[e.alg];return await crypto.subtle.importKey("jwk",e,{name:r,namedCurve:n},!0,["verify"])}};var g=I(T(),1),se=g.default.base16,ie=g.default.base32,ce=g.default.base32hex,le=g.default.base64,b=g.default.base64url,pe=g.default.codec;function E(t){return new TextDecoder().decode(b.parse(t,{loose:!0}))}function x(t){return b.stringify(new TextEncoder().encode(t),{pad:!1})}var H=new TextEncoder,U=new TextDecoder,m=H.encode.bind(H),z=U.decode.bind(U);var ee=x,te=E,$=t=>m(te(t)),u=t=>ee(z(t));var w=(t,e={})=>fetch(new Request(`https://api.passkeys.workers.dev/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"})),A;(r=>{async function t(n){return await(await w("attestation/generate",{userId:n})).json()}r.generate=t;async function e(n){let a=n.response,o={kid:u(n.rawId),clientDataJSON:u(a.clientDataJSON),attestationObject:u(a.attestationObject),jwk:await S.toJWK(await S.toCryptoKey(a.getPublicKey(),D[`${a.getPublicKeyAlgorithm()}`],P[`${a.getPublicKeyAlgorithm()}`]))};return await(await w("attestation/store",o)).json()}r.store=e})(A||={});var h;(r=>{async function t(){return await(await w("assertion/generate")).json()}r.generate=t;async function e(n){let a=n.response,o={kid:u(n.rawId),clientDataJSON:u(a.clientDataJSON),authenticatorData:u(a.authenticatorData),signature:u(a.signature)};return await(await w("assertion/verify",o)).json()}r.verify=e})(h||={});if(window.PublicKeyCredential){async function t(n,a){let{challenge:o}=await A.generate(a),i={challenge:$(o),rp:{id:window.location.host,name:document.title},user:{id:m(a),name:a,displayName:a},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-35},{type:"public-key",alg:-36}],authenticatorSelection:{userVerification:"preferred",residentKey:"required"},attestation:"indirect",timeout:6e4},s=await window.navigator.credentials.create({publicKey:i,signal:n.signal});await A.store(s)}async function e(n){let{challenge:a}=await h.generate(),o={challenge:m(a),rpId:window.location.host,timeout:6e4},i=await window.navigator.credentials.get({publicKey:o,signal:n.signal,mediation:"optional"});return await h.verify(i)}let r=document.querySelector("button#cancel");document.querySelector("form#attestation")?.addEventListener("submit",async n=>{n.preventDefault();let a=new FormData(n.target),o=new AbortController;r?.addEventListener("click",o.abort,{once:!0,signal:o.signal}),await t(o,a.get("username")),o.abort()}),document.querySelector("form#assertion")?.addEventListener("submit",async n=>{n.preventDefault();let a=new FormData(n.target),o=new AbortController;r?.addEventListener("click",o.abort,{once:!0,signal:o.signal}),await e(o),o.abort()})}
//# sourceMappingURL=index.js.map
