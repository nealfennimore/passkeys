var k=Object.create;var A=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var q=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var _=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of L(e))!N.call(t,a)&&a!==r&&A(t,a,{get:()=>e[a],enumerable:!(n=J(e,a))||n.enumerable});return t};var H=(t,e,r)=>(r=t!=null?k($(t)):{},_(e||!t||!t.__esModule?A(r,"default",{value:t,enumerable:!0}):r,t));var B=q(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});function y(t,e,r){var n;if(r===void 0&&(r={}),!e.codes){e.codes={};for(var a=0;a<e.chars.length;++a)e.codes[e.chars[a]]=a}if(!r.loose&&t.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var o=t.length;t[o-1]==="=";)if(--o,!r.loose&&!((t.length-o)*e.bits&7))throw new SyntaxError("Invalid padding");for(var s=new((n=r.out)!=null?n:Uint8Array)(o*e.bits/8|0),i=0,c=0,d=0,p=0;p<o;++p){var C=e.codes[t[p]];if(C===void 0)throw new SyntaxError("Invalid character "+t[p]);c=c<<e.bits|C,i+=e.bits,i>=8&&(i-=8,s[d++]=255&c>>i)}if(i>=e.bits||255&c<<8-i)throw new SyntaxError("Unexpected end of data");return s}function b(t,e,r){r===void 0&&(r={});for(var n=r,a=n.pad,o=a===void 0?!0:a,s=(1<<e.bits)-1,i="",c=0,d=0,p=0;p<t.length;++p)for(d=d<<8|255&t[p],c+=8;c>e.bits;)c-=e.bits,i+=e.chars[s&d>>c];if(c&&(i+=e.chars[s&d<<e.bits-c]),o)for(;i.length*e.bits&7;)i+="=";return i}var K={chars:"0123456789ABCDEF",bits:4},S={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},P={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},D={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},E={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},T={parse:function(e,r){return y(e.toUpperCase(),K,r)},stringify:function(e,r){return b(e,K,r)}},F={parse:function(e,r){return r===void 0&&(r={}),y(r.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,S,r)},stringify:function(e,r){return b(e,S,r)}},I={parse:function(e,r){return y(e,P,r)},stringify:function(e,r){return b(e,P,r)}},O={parse:function(e,r){return y(e,D,r)},stringify:function(e,r){return b(e,D,r)}},V={parse:function(e,r){return y(e,E,r)},stringify:function(e,r){return b(e,E,r)}},M={parse:y,stringify:b};u.base16=T;u.base32=F;u.base32hex=I;u.base64=O;u.base64url=V;u.codec=M});var f=H(B(),1),z=f.default.base16,ee=f.default.base32,te=f.default.base32hex,re=f.default.base64,R=f.default.base64url,ae=f.default.codec;function h(t){return R.stringify(new TextEncoder().encode(t),{pad:!1})}var U=new TextEncoder,j=new TextDecoder,m=U.encode.bind(U),G=j.decode.bind(j);var W=h;var l=t=>W(G(t));var w=class{static async toCryptoKey(e){return await crypto.subtle.importKey("spki",e,{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}static async toJWK(e){return await crypto.subtle.exportKey("jwk",e)}static async fromJWK(e){return await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}};var v=(t,e={})=>fetch(new Request(`https://api.passkeys.workers.dev/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"})),x;(r=>{async function t(n){return await(await v("attestation/generate",{userId:n})).json()}r.generate=t;async function e(n){let a=n.response,o={kid:l(n.rawId),clientDataJSON:l(a.clientDataJSON),attestationObject:l(a.attestationObject),jwk:await w.toJWK(await w.toCryptoKey(a.getPublicKey()))};return await(await v("attestation/store",o)).json()}r.store=e})(x||={});var g;(r=>{async function t(){return await(await v("assertion/generate")).json()}r.generate=t;async function e(n){let a=n.response,o={kid:l(n.rawId),clientDataJSON:l(a.clientDataJSON),authenticatorData:l(a.authenticatorData),signature:l(a.signature)};return await(await v("assertion/verify",o)).json()}r.verify=e})(g||={});var X=(s=>(s[s.ES256=-7]="ES256",s[s.ES384=-35]="ES384",s[s.ES512=-36]="ES512",s[s.RS256=-257]="RS256",s[s.RS384=-258]="RS384",s[s.RS512=-259]="RS512",s))(X||{});if(window.PublicKeyCredential){async function t(n,a){let{challenge:o}=await x.generate(a),s={challenge:m(o),rp:{id:window.location.host,name:document.title},user:{id:m(a),name:a,displayName:a},pubKeyCredParams:[{type:"public-key",alg:-7}],authenticatorSelection:{userVerification:"preferred",residentKey:"required"},attestation:"indirect",timeout:6e4},i=await window.navigator.credentials.create({publicKey:s,signal:n.signal});await x.store(i)}async function e(n){let{challenge:a}=await g.generate(),o={challenge:m(a),rpId:window.location.host,timeout:6e4},s=await window.navigator.credentials.get({publicKey:o,signal:n.signal,mediation:"optional"});return await g.verify(s)}let r=document.querySelector("button#cancel");document.querySelector("form#attestation")?.addEventListener("submit",async n=>{n.preventDefault();let a=new FormData(n.target),o=new AbortController;r?.addEventListener("click",o.abort,{once:!0,signal:o.signal}),await t(o,a.get("username")),o.abort()}),document.querySelector("form#assertion")?.addEventListener("submit",async n=>{n.preventDefault();let a=new AbortController;r?.addEventListener("click",a.abort,{once:!0,signal:a.signal}),await e(a),a.abort()})}export{X as COSEAlgorithm};
//# sourceMappingURL=index.js.map
