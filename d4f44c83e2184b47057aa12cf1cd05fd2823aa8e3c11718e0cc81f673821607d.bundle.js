var T=Object.create;var x=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty;var N=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var q=(r,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of j(e))!R.call(r,n)&&n!==t&&x(r,n,{get:()=>e[n],enumerable:!(a=$(e,n))||a.enumerable});return r};var _=(r,e,t)=>(t=r!=null?T(L(r)):{},q(e||!r||!r.__esModule?x(t,"default",{value:r,enumerable:!0}):t,r));var O=N(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});function d(r,e,t){var a;if(t===void 0&&(t={}),!e.codes){e.codes={};for(var n=0;n<e.chars.length;++n)e.codes[e.chars[n]]=n}if(!t.loose&&r.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var o=r.length;r[o-1]==="=";)if(--o,!t.loose&&!((r.length-o)*e.bits&7))throw new SyntaxError("Invalid padding");for(var i=new((a=t.out)!=null?a:Uint8Array)(o*e.bits/8|0),s=0,c=0,f=0,l=0;l<o;++l){var E=e.codes[r[l]];if(E===void 0)throw new SyntaxError("Invalid character "+r[l]);c=c<<e.bits|E,s+=e.bits,s>=8&&(s-=8,i[f++]=255&c>>s)}if(s>=e.bits||255&c<<8-s)throw new SyntaxError("Unexpected end of data");return i}function y(r,e,t){t===void 0&&(t={});for(var a=t,n=a.pad,o=n===void 0?!0:n,i=(1<<e.bits)-1,s="",c=0,f=0,l=0;l<r.length;++l)for(f=f<<8|255&r[l],c+=8;c>e.bits;)c-=e.bits,s+=e.chars[i&f>>c];if(c&&(s+=e.chars[i&f<<e.bits-c]),o)for(;s.length*e.bits&7;)s+="=";return s}var P={chars:"0123456789ABCDEF",bits:4},K={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},k={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},D={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},J={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},V={parse:function(e,t){return d(e.toUpperCase(),P,t)},stringify:function(e,t){return y(e,P,t)}},M={parse:function(e,t){return t===void 0&&(t={}),d(t.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,K,t)},stringify:function(e,t){return y(e,K,t)}},G={parse:function(e,t){return d(e,k,t)},stringify:function(e,t){return y(e,k,t)}},W={parse:function(e,t){return d(e,D,t)},stringify:function(e,t){return y(e,D,t)}},Q={parse:function(e,t){return d(e,J,t)},stringify:function(e,t){return y(e,J,t)}},X={parse:d,stringify:y};p.base16=V;p.base32=M;p.base32hex=G;p.base64=W;p.base64url=Q;p.codec=X});var F={["ES256"]:"P-256",["ES384"]:"P-384",["ES512"]:"P-512"},I={["ES256"]:"ECDSA",["ES384"]:"ECDSA",["ES512"]:"ECDSA"};var v={[(-7).toString()]:"P-256",[(-35).toString()]:"P-384",[(-36).toString()]:"P-512"},C={[(-7).toString()]:"ECDSA",[(-35).toString()]:"ECDSA",[(-36).toString()]:"ECDSA"},S=class{static async toCryptoKey(e,t,a){return await crypto.subtle.importKey("spki",e,{name:t,namedCurve:a},!0,["verify"])}static async toJWK(e){return await crypto.subtle.exportKey("jwk",e)}static async fromJWK(e){let t=I[e.alg],a=F[e.alg];return await crypto.subtle.importKey("jwk",e,{name:t,namedCurve:a},!0,["verify"])}};var g=_(O(),1),ne=g.default.base16,ae=g.default.base32,oe=g.default.base32hex,se=g.default.base64,B=g.default.base64url,ie=g.default.codec;function h(r){return B.stringify(new TextEncoder().encode(r),{pad:!1})}var U=new TextEncoder,H=new TextDecoder,b=U.encode.bind(U),Y=H.decode.bind(H);var Z=h;var u=r=>Z(Y(r));var A=(r,e={})=>fetch(new Request(`https://api.passkeys.workers.dev/${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"})),m;(t=>{async function r(a){return await(await A("attestation/generate",{userId:a})).json()}t.generate=r;async function e(a){let n=a.response,o={kid:u(a.rawId),clientDataJSON:u(n.clientDataJSON),attestationObject:u(n.attestationObject),jwk:await S.toJWK(await S.toCryptoKey(n.getPublicKey(),C[`${n.getPublicKeyAlgorithm()}`],v[`${n.getPublicKeyAlgorithm()}`]))};return await(await A("attestation/store",o)).json()}t.store=e})(m||={});var w;(t=>{async function r(){return await(await A("assertion/generate")).json()}t.generate=r;async function e(a){let n=a.response,o={kid:u(a.rawId),clientDataJSON:u(n.clientDataJSON),authenticatorData:u(n.authenticatorData),signature:u(n.signature)};return await(await A("assertion/verify",o)).json()}t.verify=e})(w||={});if(window.PublicKeyCredential){async function r(a,n){let{challenge:o}=await m.generate(n),i={challenge:b(o),rp:{id:window.location.host,name:document.title},user:{id:b(n),name:n,displayName:n},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-35},{type:"public-key",alg:-36}],authenticatorSelection:{userVerification:"preferred",residentKey:"required"},attestation:"indirect",timeout:6e4},s=await window.navigator.credentials.create({publicKey:i,signal:a.signal});await m.store(s)}async function e(a){let{challenge:n}=await w.generate(),o={challenge:b(n),rpId:window.location.host,timeout:6e4},i=await window.navigator.credentials.get({publicKey:o,signal:a.signal,mediation:"optional"});return await w.verify(i)}let t=document.querySelector("button#cancel");document.querySelector("form#attestation")?.addEventListener("submit",async a=>{a.preventDefault();let n=new FormData(a.target),o=new AbortController;t?.addEventListener("click",o.abort,{once:!0,signal:o.signal}),await r(o,n.get("username")),o.abort()}),document.querySelector("form#assertion")?.addEventListener("submit",async a=>{a.preventDefault();let n=new AbortController;t?.addEventListener("click",n.abort,{once:!0,signal:n.signal}),await e(n),n.abort()})}
//# sourceMappingURL=index.js.map
